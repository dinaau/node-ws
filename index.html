<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catch the Stars - 迷你小游戏</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        *{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif}
        :root{
            --bg:#0f1724;--panel:#0b1220;--accent:#ffd166;--accent2:#06d6a0;--muted:#94a3b8;--white:#ffffff;
        }
        body{background:linear-gradient(180deg,#081124 0%, #071827 100%);color:var(--white);min-height:100vh}
        header{background:linear-gradient(90deg,#0b1320,#071127);padding:12px 0;position:sticky;top:0;z-index:10;box-shadow:0 2px 10px rgba(0,0,0,.4)}
        .container{width:90%;max-width:1100px;margin:0 auto}
        .nav-container{display:flex;justify-content:space-between;align-items:center}
        .logo{display:flex;gap:10px;align-items:center;font-weight:700}
        .logo i{font-size:1.6rem;color:var(--accent)}
        nav ul{display:flex;gap:1.2rem;list-style:none}
        nav a{color:var(--white);text-decoration:none;opacity:.9}
        .hero{display:flex;align-items:center;justify-content:center;padding:40px 0}
        .panel{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));border-radius:12px;padding:24px;width:100%;box-shadow:0 10px 30px rgba(0,0,0,.6);display:grid;grid-template-columns:1fr 340px;gap:20px}
        .game-area{background:linear-gradient(180deg,#071827 0%, #082233 100%);border-radius:10px;position:relative;overflow:hidden;padding:12px}
        .game-canvas{width:100%;height:560px;background:radial-gradient(circle at 20% 10%, rgba(255,209,102,0.06), transparent 10%), url('https://images.unsplash.com/photo-1444703686981-a3abbc4d4fe3?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80') center/cover no-repeat;display:block;border-radius:6px;position:relative}
        .hud{display:flex;gap:12px;position:absolute;top:12px;left:12px;z-index:5}
        .stat{background:rgba(0,0,0,0.35);padding:8px 12px;border-radius:10px;backdrop-filter:blur(4px)}
        .stat small{display:block;color:var(--muted);font-size:12px}
        .controls{padding:12px;display:flex;flex-direction:column;gap:12px}
        .controls .btn{background:var(--accent);color:#071127;padding:10px;border-radius:10px;border:none;font-weight:700;cursor:pointer}
        .controls .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.08);color:var(--white)}
        .leaderboard{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:10px}
        .leaderboard h3{font-size:1.1rem;margin-bottom:8px;color:var(--accent2)}
        .list{list-style:none;padding:0;margin:0;max-height:220px;overflow:auto}
        .list li{padding:8px;border-bottom:1px dashed rgba(255,255,255,0.03);display:flex;justify-content:space-between;font-size:14px}
        footer{margin-top:24px;padding:18px 0;color:var(--muted);text-align:center}

        /* player */
        .player{position:absolute;bottom:12px;left:50%;transform:translateX(-50%);width:110px;height:48px;border-radius:999px;background:linear-gradient(90deg,#ffffff10,#ffffff06);display:flex;align-items:center;justify-content:center;z-index:4}
        .player .tray{width:90%;height:22px;border-radius:999px;background:linear-gradient(90deg,#ffd166,#ffb703);box-shadow:0 6px 16px rgba(255,177,3,.14)}

        /* falling stars */
        .star{position:absolute;width:28px;height:28px;border-radius:6px;background:linear-gradient(180deg,#fff7cc,#ffd166);box-shadow:0 6px 18px rgba(255,209,102,.14);display:flex;align-items:center;justify-content:center;font-size:12px;color:#122}

        /* mobile adjustments */
        @media (max-width:900px){.panel{grid-template-columns:1fr}.game-canvas{height:420px}.leaderboard{order:3}}
    </style>
</head>
<body>
<header>
    <div class="container nav-container">
        <div class="logo"><i class="fas fa-meteor"></i><span>Catch the Stars</span></div>
        <nav>
            <ul>
                <li><a href="#">Home</a></li>
                <li><a href="#play">Play</a></li>
                <li><a href="#about">About</a></li>
            </ul>
        </nav>
    </div>
</header>

<main class="container">
    <section class="hero">
        <div class="panel">
            <!-- Game area -->
            <div class="game-area">
                <div class="hud">
                    <div class="stat"><small>Score</small><strong id="score">0</strong></div>
                    <div class="stat"><small>Time</small><strong id="time">60</strong></div>
                    <div class="stat"><small>Lives</small><strong id="lives">3</strong></div>
                </div>

                <div id="canvas" class="game-canvas" aria-label="游戏区域">
                    <!-- Player tray -->
                    <div id="player" class="player" style="left:50%;">
                        <div class="tray"></div>
                    </div>
                </div>

                <div style="position:absolute;right:12px;bottom:12px;z-index:6;">
                    <button id="pauseBtn" class="btn secondary">暂停</button>
                </div>

            </div>

            <!-- Side controls -->
            <aside class="controls">
                <div>
                    <button id="startBtn" class="btn">开始游戏</button>
                    <button id="resetBtn" class="btn secondary" style="margin-left:8px;">重置</button>
                </div>
                <div class="leaderboard">
                    <h3><i class="fas fa-list-ol"></i> 本地排行榜</h3>
                    <ul id="leaders" class="list">
                        <li>--- <span>0</span></li>
                    </ul>
                </div>
                <div style="color:var(--muted);font-size:13px;line-height:1.4">
                    <strong>说明：</strong>
                    <p>移动鼠标或使用左右方向键来移动托盘，接住掉落的星星得分。60秒结束或生命用尽游戏结束。</p>
                </div>
            </aside>
        </div>
    </section>

    <footer>
        &copy; 2025 Catch the Stars — 静态单文件示例
    </footer>
</main>

<script>
    // 简单而完整的静态小游戏逻辑
    (function(){
        const canvas = document.getElementById('canvas');
        const player = document.getElementById('player');
        const scoreEl = document.getElementById('score');
        const timeEl = document.getElementById('time');
        const livesEl = document.getElementById('lives');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const leaders = document.getElementById('leaders');

        let width, height;
        let score = 0, timeLeft = 60, lives = 3;
        let running = false, paused = false;
        let spawnInterval = 900; // ms initial
        let starTimer = null;
        let gameTimer = null;
        let stars = new Set();
        let playerX = 0; // center position in px

        function resize(){
            width = canvas.clientWidth; height = canvas.clientHeight;
            // place player center
            playerX = width/2 - player.clientWidth/2;
            player.style.left = playerX + 'px';
        }
        window.addEventListener('resize', resize);

        // helper: create star element
        function createStar(){
            const s = document.createElement('div');
            s.className = 'star';
            s.innerHTML = '<i class="fas fa-star"></i>';
            // random x
            const x = Math.max(6, Math.random()*(width-36));
            s.style.left = x + 'px';
            s.style.top = '-40px';
            canvas.appendChild(s);

            // speed and value
            const speed = 1.6 + Math.random()*2.4; // px per frame
            const value = Math.random() < 0.12 ? 5 : 1; // rare star=5
            s.dataset.speed = speed;
            s.dataset.value = value;
            stars.add(s);
        }

        // game loop using requestAnimationFrame
        function gameLoop(){
            if(!running || paused) return;
            for(const s of Array.from(stars)){
                const y = parseFloat(s.style.top);
                const newY = y + parseFloat(s.dataset.speed)*2; // accelerate
                s.style.top = newY + 'px';

                // collision check with player tray
                const trayRect = player.getBoundingClientRect();
                const starRect = s.getBoundingClientRect();
                const canvasRect = canvas.getBoundingClientRect();
                // check if star reaches bottom (missed)
                if(starRect.bottom >= trayRect.top && starRect.left + starRect.width > trayRect.left && starRect.left < trayRect.right){
                    // caught
                    const v = Number(s.dataset.value)||1;
                    score += v;
                    scoreEl.innerText = score;
                    // show small pop
                    explode(s, true);
                    continue;
                }
                if(starRect.top > canvasRect.height){
                    // missed
                    stars.delete(s);
                    s.remove();
                    lives -= 1;
                    livesEl.innerText = lives;
                    if(lives <= 0){ endGame(); return; }
                }
            }
            requestAnimationFrame(gameLoop);
        }

        function explode(el, caught){
            // small animation then remove
            el.style.transition = 'transform .18s linear, opacity .18s linear';
            if(caught){
                el.style.transform = 'scale(1.5) rotate(20deg)';
                el.style.opacity = '0';
            } else {
                el.style.opacity = '0';
            }
            stars.delete(el);
            setTimeout(()=>{ try{ el.remove(); }catch(e){} },220);
        }

        // spawn control
        function startSpawning(){
            if(starTimer) clearInterval(starTimer);
            starTimer = setInterval(()=>{
                if(!running || paused) return;
                // increase difficulty gradually
                createStar();
                if(Math.random() < 0.08) { // occasional double spawn
                    setTimeout(createStar, 180);
                }
            }, Math.max(300, spawnInterval));
        }

        function startGame(){
            if(running) return;
            running = true; paused = false;
            score = 0; timeLeft = 60; lives = 3;
            scoreEl.innerText = score; timeEl.innerText = timeLeft; livesEl.innerText = lives;
            // clear old stars
            for(const s of Array.from(stars)){ s.remove(); stars.delete(s); }
            resize();
            startSpawning();
            // timer
            if(gameTimer) clearInterval(gameTimer);
            gameTimer = setInterval(()=>{
                if(paused) return;
                timeLeft -= 1; timeEl.innerText = timeLeft;
                // speed up difficulty
                if(timeLeft%10 === 0) spawnInterval = Math.max(300, spawnInterval - 80);
                if(timeLeft <= 0){ endGame(); }
            }, 1000);
            requestAnimationFrame(gameLoop);
        }

        function pauseGame(){
            if(!running) return;
            paused = !paused;
            pauseBtn.innerText = paused ? '继续' : '暂停';
            if(!paused) requestAnimationFrame(gameLoop);
        }

        function endGame(){
            running = false; paused = false;
            clearInterval(starTimer); clearInterval(gameTimer);
            pauseBtn.innerText = '暂停';
            saveScore(score);
            showResults();
        }

        function resetGame(){
            running = false; paused = false;
            clearInterval(starTimer); clearInterval(gameTimer);
            for(const s of Array.from(stars)){ s.remove(); stars.delete(s); }
            score = 0; timeLeft = 60; lives = 3; spawnInterval = 900;
            scoreEl.innerText = score; timeEl.innerText = timeLeft; livesEl.innerText = lives;
            pauseBtn.innerText = '暂停';
        }

        function showResults(){
            // brief modal-like alert
            setTimeout(()=>{
                alert('游戏结束! 你的得分: ' + score);
            }, 120);
            renderLeaders();
        }

        // input: mouse and keyboard
        let isDragging = false;
        canvas.addEventListener('mousemove', (e)=>{
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left - player.clientWidth/2;
            playerX = Math.max(6, Math.min(x, rect.width - player.clientWidth - 6));
            player.style.left = playerX + 'px';
        });
        canvas.addEventListener('touchmove', (e)=>{
            const t = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            const x = t.clientX - rect.left - player.clientWidth/2;
            playerX = Math.max(6, Math.min(x, rect.width - player.clientWidth - 6));
            player.style.left = playerX + 'px';
        }, {passive:true});

        window.addEventListener('keydown',(e)=>{
            if(e.key === 'ArrowLeft' || e.key === 'a'){
                playerX = Math.max(6, playerX - 28);
                player.style.left = playerX + 'px';
            } else if(e.key === 'ArrowRight' || e.key === 'd'){
                playerX = Math.min(width - player.clientWidth - 6, playerX + 28);
                player.style.left = playerX + 'px';
            }
        });

        // local leaderboard using localStorage
        function saveScore(val){
            try{
                const key = 'cts_leaderboard_v1';
                const raw = localStorage.getItem(key);
                let arr = raw ? JSON.parse(raw) : [];
                const name = '玩家';
                arr.push({name, score: val, date: new Date().toISOString()});
                arr = arr.sort((a,b)=>b.score-a.score).slice(0,10);
                localStorage.setItem(key, JSON.stringify(arr));
            }catch(e){console.warn(e)}
        }
        function renderLeaders(){
            try{
                const raw = localStorage.getItem('cts_leaderboard_v1');
                let arr = raw ? JSON.parse(raw) : [];
                if(arr.length === 0){ leaders.innerHTML = '<li>--- <span>0</span></li>'; return; }
                leaders.innerHTML = '';
                arr.forEach((r,i)=>{
                    const li = document.createElement('li');
                    li.innerHTML = `<span>#${i+1} ${r.name}</span><span>${r.score}</span>`;
                    leaders.appendChild(li);
                });
            }catch(e){console.warn(e)}
        }

        // small utility to remove offscreen stars
        setInterval(()=>{
            for(const s of Array.from(stars)){
                const rect = s.getBoundingClientRect();
                if(rect.top > canvas.clientHeight + 200){
                    stars.delete(s); try{ s.remove(); }catch(e){}
                }
            }
        }, 2000);

        // button events
        startBtn.addEventListener('click', ()=>{ startGame(); renderLeaders(); });
        pauseBtn.addEventListener('click', ()=>{ pauseGame(); });
        resetBtn.addEventListener('click', ()=>{ resetGame(); renderLeaders(); });

        // init
        resize(); renderLeaders();

    })();
</script>
</body>
</html>
